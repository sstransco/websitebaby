<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sigma Squared Transport Corporation - Dispatch</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Force 90s aesthetics overrides */
        body {
            background-color: #c0c0c0; /* Classic Windows 95/98 background gray */
            font-family: "Courier New", Courier, monospace; /* Monospace for that terminal/typewriter feel */
        }
        .win-border {
            border-top: 2px solid #dfdfdf;
            border-left: 2px solid #dfdfdf;
            border-right: 2px solid #000000;
            border-bottom: 2px solid #000000;
            background-color: #c0c0c0;
        }
        .inset-border {
            border-top: 2px solid #000000;
            border-left: 2px solid #000000;
            border-right: 2px solid #dfdfdf;
            border-bottom: 2px solid #dfdfdf;
            background-color: #ffffff;
        }
        .btn-active:active {
            border-top: 2px solid #000000;
            border-left: 2px solid #000000;
            border-right: 2px solid #dfdfdf;
            border-bottom: 2px solid #000000;
        }
        a {
            color: blue;
            text-decoration: underline;
        }
        a:hover {
            color: red;
            background-color: yellow;
        }
        /* Style for the floating minimized window button (Only one now) */
        #openButton {
            position: fixed;
            bottom: 1rem;
            left: 1rem;
            /* Use win-border style for consistency */
            border-top: 2px solid #dfdfdf;
            border-left: 2px solid #dfdfdf;
            border-right: 2px solid #000000;
            border-bottom: 2px solid #000000;
            background-color: #c0c0c0;
            padding: 4px 8px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: bold;
            display: none; /* Hidden by default */
            z-index: 1000;
        }
        /* Style for the new market data banner */
        .market-banner {
            background-color: #800080; /* Purple/Magenta for a different 90s look */
            color: #FFFFFF;
            font-weight: bold;
            font-size: 0.85rem;
            padding: 4px 0;
            margin-top: 4px; /* Space between the two banners */
        }
        /* Style for the INTEGRATED Chat Window (now static) */
        #chatWindow {
            width: 100%; 
            height: 320px; /* REDUCED HEIGHT FOR MOBILE CLEARANCE */
            margin-top: 20px; 
            margin-bottom: 20px; 
        }
        .chat-title-bar {
            background-color: #008000; /* Green color for the chat window */
            color: white;
            font-weight: bold;
            padding: 4px 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .chat-history {
            height: 120px; /* FURTHER REDUCED HISTORY HEIGHT FOR MOBILE */
            overflow-y: auto; /* Scrollable */
            padding: 10px;
            background-color: #e0e0e0; /* Light gray background */
        }
        .message-user {
            text-align: right;
            color: blue;
        }
        .message-assistant {
            text-align: left;
            color: #008000; /* Green */
        }
        /* Mascot Image Styling */
        #mascot-avatar {
            width: 80px;
            height: auto;
            border: 2px solid #008000;
            display: block;
            /* Removed margin-right to prevent layout push */
        }

        /* --- TRUCK ANIMATION STYLES --- */
        #truck-animation-track {
            height: 24px; /* Height of the road/lane */
            border-bottom: 2px solid black;
            border-top: 2px dashed black; /* Dashed line for the road */
            overflow: hidden; /* Keep the truck inside the boundary */
            position: relative;
            margin-bottom: 20px;
            background-color: #888; /* Darker grey road color */
        }
        #pixel-truck {
            position: absolute;
            top: 0px; /* Vertically center the truck */
            white-space: nowrap; /* Keep the truck together */
            font-size: 14px;
            color: #FF0000; /* Red cab */
            text-shadow: 1px 1px 0 #000000;
            /* Animation runs continuously */
            animation: drive-across 20s linear infinite; 
        }
        /* Keyframe animation: Starts RIGHT, moves LEFT (Trucks face left) */
        @keyframes drive-across {
            0% { transform: translateX(100vw); } /* Start completely off the RIGHT side */
            100% { transform: translateX(-100%); } /* End completely off the LEFT side */
        }
        
        /* --- MULTI-COLOR GLOW STYLES --- */
        @keyframes multi-glow {
            0% { box-shadow: 0 0 10px #00ff00; } /* Neon Green */
            25% { box-shadow: 0 0 10px #00FFFF; } /* Cyan */
            50% { box-shadow: 0 0 10px #FF00FF; } /* Magenta */
            75% { box-shadow: 0 0 10px #FFFF00; } /* Yellow */
            100% { box-shadow: 0 0 10px #00ff00; } /* Loop back to Green */
        }
        .glowing-btn {
            animation: multi-glow 4s ease-in-out infinite; /* Apply the glow */
        }
        
        /* New Staggered Animation Class: USE NEGATIVE DELAY FOR INSTANT START */
        .glowing-btn.stagger {
            animation-delay: -2s; /* Start immediately, but 2 seconds into the 4s animation cycle */
        }
    </style>
</head>
<body class="p-4 min-h-screen flex flex-col items-center justify-start">

    <!-- Button to restore the MINIMIZED MAIN WEBSITE WINDOW (initially hidden) -->
    <div id="openButton" onclick="openWindow()">
        <span class="bg-[#000080] text-white px-1 mr-2">[ ]</span>
        SST_HOMEPAGE.EXE
    </div>
    
    <!-- MINIMIZED CHAT BUTTON (REMOVED - Chat is now integrated) -->

    <!-- MAIN WEBSITE CONTAINER -->
    <div id="mainContainer" class="win-border p-1 w-full max-w-3xl shadow-xl">
        
        <!-- Title Bar -->
        <div class="bg-[#000080] text-white px-2 py-1 font-bold text-lg mb-4 flex justify-between items-center">
            <span>SST_HOMEPAGE.EXE</span>
            <!-- The 'X' button calls the minimize function -->
            <span class="text-sm border border-white px-1 cursor-pointer" onclick="minimizeWindow()">X</span>
        </div>

        <!-- Content Area -->
        <div class="px-4 py-6 text-black pb-24"> <!-- INCREASED pb-24 for extensive mobile footer clearance -->
            
            <!-- Header / Logo Area -->
            <div class="text-center mb-8">
                <!-- Logo Image Container -->
                <div class="inline-block border-2 border-black bg-white p-4 mb-4 min-w-[200px] min-h-[100px] flex items-center justify-center">
                    <img src="Logotype@4x.png" class="max-w-[300px] h-auto mx-auto block" style="display: block;">
                </div>
            </div>
            
            <!-- Capabilities Section -->
            <div class="mb-8">
                <div class="inset-border p-6 text-center">
                    <h2 class="bg-black text-white text-xl font-bold px-2 py-1 mb-4 uppercase inline-block">Capabilities</h2>
                    <div class="flex flex-wrap justify-center gap-4 font-bold text-lg uppercase">
                        <span class="border border-black px-2 bg-gray-200">Truckload</span>
                        <span class="border border-black px-2 bg-gray-200">Refrigerated</span>
                        <span class="border border-black px-2 bg-gray-200">Flatbed</span>
                        <span class="border border-black px-2 bg-gray-200">Nationwide (All 48)</span>
                    </div>
                </div>
            </div>

            <!-- Contact Info Large -->
            <div class="win-border p-6 bg-white mb-8 text-center">
                <h3 class="text-xl font-bold mb-4 underline">CONTACT OUR TEAM</h3>
                <p class="text-xl md:text-2xl">
                    <a href="mailto:dispatch@sstransco.com" class="no-underline text-black hover:bg-yellow-300">dispatch@sstransco.com</a>
                </p>
            </div>
            
            <!-- TRUCK ANIMATION TRACK -->
            <div id="truck-animation-track" class="w-full">
                <!-- Simple ASCII/Text Truck Convoy -->
                <div id="pixel-truck" style="font-family: monospace;">
                    ðŸš› â–ˆ-â–ˆ-â–ˆ ðŸš› â–ˆ-â–ˆ-â–ˆ ðŸš› â–ˆ-â–ˆ-â–ˆ
                </div>
            </div>

            <!-- Navigation to Subpages - ADDED STAGGER CLASS TO SECOND BUTTON -->
            <div class="flex flex-col sm:flex-row justify-center gap-4 mb-8 border-t-2 border-b-2 border-black py-4">
                <a href="fleet.html" class="win-border px-6 py-3 bg-gray-300 text-black font-bold no-underline hover:bg-gray-400 btn-active text-center uppercase text-lg mb-2 sm:mb-0 glowing-btn">
                    [ OUR FLEET ]
                </a>
                <!-- New ABOUT US Button - ADDED GLOWING-BTN CLASS AND STAGGER -->
                <a href="about.html" class="win-border px-6 py-3 bg-gray-300 text-black font-bold no-underline hover:bg-gray-400 btn-active text-center uppercase text-lg glowing-btn stagger">
                    [ ABOUT US ]
                </a>
            </div>

            <!-- CHAT MASCOT WINDOW (Integrated Here) -->
            <div id="chatWindow" class="win-border mt-8"> 
                <div class="chat-title-bar">
                    <span>CHAT ASSISTANT (SYSTEM ONLINE)</span>
                    <span class="text-xs border border-white px-1">READY</span>
                </div>
                <div class="p-2 flex flex-col bg-white h-[calc(100%-30px)]"> <!-- Adjust height to fill the box -->
                    
                    <!-- Mascot and Initial Message Container -->
                    <div class="inset-border p-2 mb-3 flex items-start bg-gray-100">
                        <!-- MASCOT AVATAR INSIDE CHAT BOX -->
                        <img id="mascot-avatar" src="officialsigmasquaredmascot.png" alt="Sigma Squared Mascot" class="max-w-[80px] h-auto block mr-3">
                        <div class="flex-grow">
                            <p class="text-sm font-bold text-black mb-1">Need assistance? This channel is open.</p>
                            <p class="text-xs text-gray-600">Ask about rates, fleet, or company vision.</p>
                        </div>
                    </div>

                    <!-- Chat History Area -->
                    <div id="chatHistory" class="chat-history mb-2 inset-border p-2 flex-grow">
                        <p class="message-assistant text-sm mb-1">Welcome! I'm your digital dispatcher. Ask me about our services or fleet.</p>
                    </div>

                    <!-- Input Box and Button -->
                    <div class="flex items-center">
                        <input type="text" id="chatInput" placeholder="Type message..." class="flex-grow p-1 border-2 border-black focus:outline-none focus:border-blue-500 text-sm">
                        <button onclick="sendMessage()" class="ml-2 px-3 py-1 bg-gray-300 win-border text-black font-bold text-sm btn-active">
                            SEND
                        </button>
                    </div>
                </div>
            </div>

            <!-- NEW RATE QUOTE TERMINAL (MOVED BELOW CHAT) -->
            <div class="mb-8 p-4 win-border bg-gray-200">
                <h3 class="bg-[#000080] text-white text-lg font-bold px-2 py-1 mb-4 text-center">INSTANT RATE QUOTE TERMINAL V1.0</h3>
                <div class="inset-border p-4 bg-white">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-3 mb-4 text-sm font-bold">
                        <div>
                            <label for="loadType" class="block mb-1">LOAD TYPE:</label>
                            <select id="loadType" class="w-full border border-black p-1">
                                <option value="reefer">REEFER (FTL)</option>
                                <option value="flatbed">FLATBED (FTL)</option>
                                <!-- Removed: <option value="dry">DRY VAN (FTL)</option> -->
                            </select>
                        </div>
                        <div>
                            <label for="origin" class="block mb-1">ORIGIN (State Code):</label>
                            <input type="text" id="origin" placeholder="E.g., CA" class="w-full border border-black p-1 uppercase">
                        </div>
                        <div>
                            <label for="destination" class="block mb-1">DESTINATION (State Code):</label>
                            <input type="text" id="destination" placeholder="E.g., NY" class="w-full border border-black p-1 uppercase">
                        </div>
                    </div>
                    
                    <button onclick="calculateQuote()" class="w-full bg-green-500 text-white font-bold p-2 mb-4 border-2 border-black hover:bg-green-600 btn-active uppercase">
                        [ RUN SIMULATION & GET RATE ]
                    </button>

                    <div id="quoteResult" class="text-center font-bold inset-border p-2 min-h-[40px] bg-yellow-100">
                        Input Load Details Above and Click Button.
                    </div>
                </div>
            </div>
            <!-- END RATE QUOTE TERMINAL -->


            <!-- Footer -->
            <div class="text-center text-xs border-t border-black pt-4 mt-8">
                <p>&copy; 2025 SIGMA SQUARED TRANSPORT CORPORATION.</p>
                <p class="mt-1">ALL RIGHTS RESERVED. USA.</p>
                <marquee class="mt-2 bg-black text-white font-bold" scrollamount="3">
                    SERVING ALL 48 STATES /// REFRIGERATED /// FLATBED /// E-MAIL US DISPATCH@SSTRANSCO.COM ///
                </marquee>
                
                <!-- NEW MARKET DATA BANNER -->
                <marquee class="market-banner" scrollamount="4" id="marketTicker">
                    LOADING LIVE MARKET DATA...
                </marquee>
            </div>
            
            <!-- TRUCK ANIMATION TRACK (MOVED TO THE VERY BOTTOM) -->
            <div id="truck-animation-track" class="w-full mt-4">
                <!-- Simple ASCII/Text Truck Convoy -->
                <div id="pixel-truck" style="font-family: monospace;">
                    ðŸš› â–ˆ-â–ˆ-â–ˆ ðŸš› â–ˆ-â–ˆ-â–ˆ ðŸš› â–ˆ-â–ˆ-â–ˆ
                </div>
            </div>


        </div>
    </div>

    <script>
        // --- WINDOW MINIMIZATION FUNCTIONS (MAIN SITE) ---
        const mainContainer = document.getElementById('mainContainer');
        const openButton = document.getElementById('openButton');
        
        function minimizeWindow() {
            mainContainer.style.display = 'none';
            openButton.style.display = 'block';
        }

        function openWindow() {
            mainContainer.style.display = 'block';
            openButton.style.display = 'none';
        }
        
        // --- RATE QUOTE LOGIC ---
        // STATIC REFERENCE VALUES
        const NATIONAL_DIESEL_AVG = 3.868; // USD/gal (Based on recent EIA averages)
        const MPG_AVG = 7.0; // Industry average MPG for heavy-duty trucking

        function calculateQuote() {
            const loadType = document.getElementById('loadType').value;
            const origin = document.getElementById('origin').value.toUpperCase();
            const destination = document.getElementById('destination').value.toUpperCase();
            const resultDiv = document.getElementById('quoteResult');

            if (origin.length < 2 || destination.length < 2) {
                resultDiv.innerHTML = "ERROR: Please enter valid 2-letter State Codes for Origin and Destination.";
                resultDiv.classList.remove('bg-yellow-100', 'bg-green-300');
                resultDiv.classList.add('bg-red-400', 'text-white');
                return;
            }

            // --- 1. DETERMINE MARKET BASE RATE (SIMULATED NATIONAL AVERAGE CPM FOR THE ROUTE) ---
            
            // Map common state codes to regional market rate adjustments (CPM)
            // Rates are based on a static simulation of typical high/low rate areas.
            const REEFER_BASE = 2.90; // Starting point for Reefer FTL market average
            const FLATBED_BASE = 2.80; // Starting point for Flatbed FTL market average

            const MARKET_ADJUSTMENTS = {
                // High Rate States (e.g., California, NY, NJ, WA - High Operating Cost/Demand)
                CA: 0.35, NY: 0.30, NJ: 0.25, WA: 0.25, MA: 0.20,
                // Low Rate States (e.g., Rural Midwest/South - Low Demand/Low Cost)
                SD: -0.15, ND: -0.10, WY: -0.10, KS: -0.05, NE: -0.05
            };

            let loadTypeBase = (loadType === 'reefer') ? REEFER_BASE : FLATBED_BASE;
            
            // Calculate Average Market Adjustment based on Origin and Destination
            const originAdjustment = MARKET_ADJUSTMENTS[origin] || 0;
            const destinationAdjustment = MARKET_ADJUSTMENTS[destination] || 0;
            
            const marketRatePerMile = loadTypeBase + ((originAdjustment + destinationAdjustment) / 2);
            
            // --- 2. CALCULATE FUEL COST PER MILE (FCPM) ---
            const FCPM = NATIONAL_DIESEL_AVG / MPG_AVG; // Approx $0.55 per mile

            // --- 3. CALCULATE NATIONAL AVERAGE TOTAL COST PER MILE (CPM_AVG) ---
            // Total CPM Average = Market Rate Per Mile + FCPM 
            const CPM_AVG = marketRatePerMile + FCPM;
            
            // --- 4. APPLY 15% UNDER NATIONAL AVERAGE POLICY ---
            // Changed from 0.99 (1% under) to 0.85 (15% under)
            const CPM_SSTC = CPM_AVG * 0.85; 

            // --- 5. DETERMINE DISTANCE AND FINAL RATE ---
            let distance = 1550; 
            
            if ((origin === 'CA' && destination === 'NY') || (destination === 'CA' && origin === 'NY')) {
                distance = 2800;
            } else if ((origin === 'TX' && destination === 'FL') || (destination === 'TX' && origin === 'FL')) {
                distance = 1200;
            } else if (origin === 'SD' || destination === 'ND' || origin === 'MT' || destination === 'MT') {
                distance = 900;
            }
            
            const finalRatePerLoad = CPM_SSTC * distance;
            
            resultDiv.innerHTML = `SIMULATION COMPLETE: Estimated Load Rate $${finalRatePerLoad.toFixed(2)} (Route: ${origin} to ${destination}, ${distance} mi). Estimated CPM: $${CPM_SSTC.toFixed(2)}. Please call dispatch to confirm.`;
            resultDiv.classList.remove('bg-yellow-100', 'bg-red-400', 'text-white');
            resultDiv.classList.add('bg-green-300');
        }

        // --- CHAT LOGIC (Same as previous version) ---
        const chatInput = document.getElementById('chatInput');
        const chatHistory = document.getElementById('chatHistory');

        function appendMessage(text, sender) {
            const p = document.createElement('p');
            p.innerHTML = text; 
            p.className = `text-sm mb-1 ${sender === 'user' ? 'message-user' : 'message-assistant'}`;
            chatHistory.appendChild(p);
            chatHistory.scrollTop = chatHistory.scrollHeight;
        }

        const responseMap = [
            { 
                keywords: ['hello', 'hi', 'hey', 'greetings', 'who are you', 'whats up'],
                responses: ["Greetings, User. I am the **Official SSTC Dispatch Assistant**. Ready to route freight across the nation.", "Affirmative. How may I assist your transport needs?", "Welcome to SSTC. Processing query...", "Hello! What can I compute for you today?"],
            },
            { 
                keywords: ['service', 'transport', 'haul', 'delivery'],
                responses: ["We specialize in OTR, Reefer, and Flatbed Full Truckload service across the entire USA (all 48 states).", "Our primary mission is **Full Truckload (FTL)** hauling: Reefer and Flatbed OTR. We do **NOT** offer dry van or local delivery.", "We do **NOT** handle local delivery. Our focus is national, long-haul transport."],
            },
            { 
                keywords: ['fleet', 'truck', 'trailer', 'tractor'],
                responses: ["Our current fleet includes Freightliner Cascadia tractors, Utility 3000R reefers, and Reitnouer MaxMiser flatbeds. See the Fleet Assets page for full specs.", "We run modern tractors optimized for OTR efficiency. More coming soon, view the 'OUR FLEET' page."],
                link: "fleet.html"
            },
            { 
                keywords: ['rate', 'quote', 'cost', 'price', 'how much'],
                responses: ["Please utilize the **Instant Rate Quote Terminal V1.0** below for an immediate estimate, then email dispatch@sstransco.com or call 605-650-3870 to confirm.", "Rate inquiries are handled directly by human dispatchers. Contact us immediately for a quote.", "To generate a precise rate, please provide load type, weight, and destination via email."],
            },
            {
                keywords: ['bitcoin', 'btc', 'treasury', 'crypto', 'finance'],
                responses: ["SSTC is committed to a **Bitcoin Treasury Standard**. We believe in sound money for long-term corporate stability.", "Our financial policy is geared toward generational value preservation through Bitcoin. View the 'ABOUT US' page.", "Yes, we focus on Bitcoinâ€”is part of our dedication to futuristic financial tech."],
                link: "about.html"
            },
            {
                keywords: ['american', 'usa', 'owned', 'employee', 'origin'],
                responses: ["We are **100% American-owned** and exclusively employ **100% American labor**. We are built for the USA.", "Our entire operation is based here, utilizing American ingenuity and workers. See our Corporate Manifesto."],
                link: "about.html"
            },
            {
                keywords: ['tech', 'technology', 'cutting edge', 'software', 'ai'],
                responses: ["We leverage cutting-edge logistics software and AI to ensure unmatched **OTR efficiency** and reliability.", "Logistics efficiency is driven by technology. We are constantly upgrading our systems.", "We are a logistics tech firm with a passion for trucking excellence."],
            },
            {
                keywords: ['website', 'design', 'retro', '90s', 'aesthetic'],
                responses: ["The interface is designed for maximum efficiency and nostalgia. **Zero bloat, maximum function**.", "This interface is modeled on classic 90s operating systems: simple, fast, and functional."],
            },
            {
                keywords: ['time', 'date', 'founded', 'year'],
                responses: ["Sigma Squared Transport Corporation was founded in **2025**.", "The current operational clock is [Current Date & Time]. Ready to transmit freight.", "We launched in 2025 to bring a modern, tech-focused approach to American logistics."],
                time: true // Flag to inject current time
            },
            {
                keywords: ['dispatch', 'email', 'phone', 'contact'],
                responses: ["You can reach Dispatch immediately via email at dispatch@sstransco.com or by phone at **605-650-3870**.", "For direct contact, please call **605-650-3870**. We're standing by."],
            },
            {
                keywords: ['thanks', 'thank you', 'ok', 'alright'],
                responses: ["Transmission terminated. Have a productive day.", "Thank you for using the Chat Assistant. Dispatch is standing by.", "Affirmative. End of session. Goodbye."],
            }
        ];

        function getAssistantResponse(message) {
            const msg = message.toLowerCase();
            
            // Find the best matching response
            for (const item of responseMap) {
                if (item.keywords.some(keyword => msg.includes(keyword))) {
                    let response = item.responses[Math.floor(Math.random() * item.responses.length)];
                    
                    // Handle specific placeholders/links
                    if (item.time) {
                        const now = new Date();
                        response = response.replace('[Current Date & Time]', now.toLocaleString());
                    }

                    if (item.link) {
                         const linkTag = `<a href="${item.link}" class="text-blue-600 underline hover:text-red-500">${item.link.toUpperCase().replace('.HTML', '')}</a>`;
                        response += ` View more details on the ${linkTag} page.`;
                    }
                    return response;
                }
            }

            // Default catch-all response
            return "I'm sorry, I cannot process that specific query. Please rephrase your question regarding our services, fleet, or company vision. You can also contact dispatch directly.";
        }

        function sendMessage() {
            const message = chatInput.value.trim();
            if (message === '') return;

            // 1. Display User Message
            appendMessage(message, 'user');

            // 2. Clear input
            chatInput.value = '';

            // 3. Get and Display Assistant Response (with a slight delay for realism)
            const response = getAssistantResponse(message);
            setTimeout(() => {
                appendMessage(response, 'assistant');
            }, 500);
        }

        // Allow pressing Enter to send message
        chatInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });


        // --- MARKET DATA FETCH ---

        const marketTicker = document.getElementById('marketTicker');

        // Helper function for fetching with retries (Exponential Backoff)
        async function fetchWithRetry(url, options = {}, retries = 3) {
            for (let i = 0; i < retries; i++) {
                try {
                    const response = await fetch(url, options);
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    return response.json();
                } catch (error) {
                    if (i === retries - 1) throw error;
                    // Exponential backoff delay
                    const delay = Math.pow(2, i) * 1000;
                    await new Promise(resolve => setTimeout(resolve, delay));
                }
            }
        }
        
        async function fetchMarketData() {
            const data = {};
            
            // 1. Bitcoin Price (Using CoinGecko API - more reliable)
            try {
                const btcApiUrl = 'https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd';
                const btcData = await fetchWithRetry(btcApiUrl);
                
                if (btcData && btcData.bitcoin && btcData.bitcoin.usd) {
                    data.btc = btcData.bitcoin.usd.toFixed(2);
                } else {
                    throw new Error("BTC data structure invalid.");
                }
            } catch (error) {
                console.error("Failed to fetch BTC price (CoinGecko):", error);
                data.btc = 'N/A';
            }

            // 2. Real Gold & Silver Prices using ETF Data (CoinGecko API)
            // Using PAX Gold (PAXG) and Kinesis Silver (KAG) as reliable proxies for spot prices
            try {
                const metalApiUrl = 'https://api.coingecko.com/api/v3/simple/price?ids=pax-gold,kinesis-silver&vs_currencies=usd';
                const metalData = await fetchWithRetry(metalApiUrl);

                if (metalData) {
                    if (metalData['pax-gold'] && metalData['pax-gold'].usd) {
                        data.gold = metalData['pax-gold'].usd.toFixed(2);
                    } else {
                        data.gold = "4000.00"; // Fallback
                    }

                    if (metalData['kinesis-silver'] && metalData['kinesis-silver'].usd) {
                        data.silver = metalData['kinesis-silver'].usd.toFixed(2);
                    } else {
                        data.silver = "50.00"; // Fallback
                    }
                }
            } catch (error) {
                console.error("Failed to fetch Metal prices (CoinGecko):", error);
                data.gold = "4000.00"; // Fallback
                data.silver = "50.00"; // Fallback
            }

            // 3. National Diesel Price (Using a representative weekly value)
            data.diesel = NATIONAL_DIESEL_AVG.toFixed(3); // Use the accurate static average

            // 4. Construct the Marquee Content
            const tickerContent = `
                LIVE MARKET FEED >> 
                BTC: $${data.btc} (USD) /// 
                SPOT GOLD (PAXG): $${data.gold} / oz /// 
                SPOT SILVER (KAG): $${data.silver} / oz /// 
                NATIONAL DIESEL: $${data.diesel} / gal (Weekly Avg)
            `;

            marketTicker.innerHTML = tickerContent.repeat(3); // Repeat to ensure smooth scrolling
        }

        // Run the fetch function when the page loads
        window.addEventListener('load', fetchMarketData);
    </script>

</body>
</html>